import type { BuildJsonSchema } from "@/types/builder";
import type { PlanTier } from "./plans";

export interface StrategyPreset {
  id: string;
  name: string;
  description: string;
  tier: PlanTier;
  buildJson: BuildJsonSchema;
}

const now = new Date().toISOString();
const meta = { createdAt: now, updatedAt: now };

export const STRATEGY_PRESETS: StrategyPreset[] = [
  {
    id: "ma-crossover",
    name: "MA Crossover",
    description:
      "Classic moving average crossover strategy using a fast (10) and slow (50) EMA. Buys when fast crosses above slow, sells when fast crosses below.",
    tier: "FREE",
    buildJson: {
      version: "1.0",
      nodes: [
        {
          id: "timing1",
          type: "always",
          position: { x: 300, y: 0 },
          data: {
            label: "Always",
            category: "timing",
            timingType: "always",
          },
        },
        {
          id: "ma-fast",
          type: "moving-average",
          position: { x: 100, y: 180 },
          data: {
            label: "Fast MA (10)",
            category: "indicator",
            indicatorType: "moving-average",
            timeframe: "H1",
            period: 10,
            method: "EMA",
            signalMode: "every_tick",
            shift: 0,
          },
        },
        {
          id: "ma-slow",
          type: "moving-average",
          position: { x: 550, y: 180 },
          data: {
            label: "Slow MA (50)",
            category: "indicator",
            indicatorType: "moving-average",
            timeframe: "H1",
            period: 50,
            method: "EMA",
            signalMode: "every_tick",
            shift: 0,
          },
        },
        {
          id: "buy1",
          type: "place-buy",
          position: { x: 100, y: 360 },
          data: {
            label: "Place Buy",
            category: "trading",
            tradingType: "place-buy",
            method: "FIXED_LOT",
            fixedLot: 0.1,
            riskPercent: 2,
            minLot: 0.01,
            maxLot: 10,
          },
        },
        {
          id: "sell1",
          type: "place-sell",
          position: { x: 550, y: 360 },
          data: {
            label: "Place Sell",
            category: "trading",
            tradingType: "place-sell",
            method: "FIXED_LOT",
            fixedLot: 0.1,
            riskPercent: 2,
            minLot: 0.01,
            maxLot: 10,
          },
        },
        {
          id: "sl-buy",
          type: "stop-loss",
          position: { x: 0, y: 540 },
          data: {
            label: "Buy Stoploss",
            category: "trading",
            tradingType: "stop-loss",
            method: "FIXED_PIPS",
            fixedPips: 50,
            atrMultiplier: 1.5,
            atrPeriod: 14,
          },
        },
        {
          id: "tp-buy",
          type: "take-profit",
          position: { x: 200, y: 540 },
          data: {
            label: "Buy Take Profit",
            category: "trading",
            tradingType: "take-profit",
            method: "RISK_REWARD",
            fixedPips: 100,
            riskRewardRatio: 2,
            atrMultiplier: 3,
            atrPeriod: 14,
          },
        },
        {
          id: "sl-sell",
          type: "stop-loss",
          position: { x: 450, y: 540 },
          data: {
            label: "Sell Stoploss",
            category: "trading",
            tradingType: "stop-loss",
            method: "FIXED_PIPS",
            fixedPips: 50,
            atrMultiplier: 1.5,
            atrPeriod: 14,
          },
        },
        {
          id: "tp-sell",
          type: "take-profit",
          position: { x: 650, y: 540 },
          data: {
            label: "Sell Take Profit",
            category: "trading",
            tradingType: "take-profit",
            method: "RISK_REWARD",
            fixedPips: 100,
            riskRewardRatio: 2,
            atrMultiplier: 3,
            atrPeriod: 14,
          },
        },
      ],
      edges: [
        { id: "e1", source: "timing1", target: "ma-fast" },
        { id: "e2", source: "timing1", target: "ma-slow" },
        { id: "e3", source: "ma-fast", target: "buy1" },
        { id: "e4", source: "ma-slow", target: "sell1" },
        { id: "e5", source: "buy1", target: "sl-buy" },
        { id: "e6", source: "buy1", target: "tp-buy" },
        { id: "e7", source: "sell1", target: "sl-sell" },
        { id: "e8", source: "sell1", target: "tp-sell" },
      ],
      viewport: { x: 0, y: 0, zoom: 0.8 },
      metadata: meta,
      settings: {
        magicNumber: 100001,
        comment: "MA Crossover",
        maxOpenTrades: 1,
        allowHedging: false,
        maxTradesPerDay: 0,
      },
    } as BuildJsonSchema,
  },
  {
    id: "rsi-mean-reversion",
    name: "RSI Mean Reversion",
    description:
      "Mean reversion strategy trading RSI oversold/overbought levels during the London session. Buys when RSI crosses above 30, sells when RSI crosses below 70.",
    tier: "FREE",
    buildJson: {
      version: "1.0",
      nodes: [
        {
          id: "timing1",
          type: "trading-session",
          position: { x: 300, y: 0 },
          data: {
            label: "London Session",
            category: "timing",
            timingType: "trading-session",
            session: "LONDON",
            tradeMondayToFriday: true,
          },
        },
        {
          id: "rsi1",
          type: "rsi",
          position: { x: 300, y: 180 },
          data: {
            label: "RSI (14)",
            category: "indicator",
            indicatorType: "rsi",
            timeframe: "H1",
            period: 14,
            signalMode: "every_tick",
            overboughtLevel: 70,
            oversoldLevel: 30,
          },
        },
        {
          id: "buy1",
          type: "place-buy",
          position: { x: 100, y: 360 },
          data: {
            label: "Place Buy",
            category: "trading",
            tradingType: "place-buy",
            method: "FIXED_LOT",
            fixedLot: 0.1,
            riskPercent: 2,
            minLot: 0.01,
            maxLot: 10,
          },
        },
        {
          id: "sell1",
          type: "place-sell",
          position: { x: 550, y: 360 },
          data: {
            label: "Place Sell",
            category: "trading",
            tradingType: "place-sell",
            method: "FIXED_LOT",
            fixedLot: 0.1,
            riskPercent: 2,
            minLot: 0.01,
            maxLot: 10,
          },
        },
        {
          id: "sl-buy",
          type: "stop-loss",
          position: { x: 0, y: 540 },
          data: {
            label: "Buy Stoploss",
            category: "trading",
            tradingType: "stop-loss",
            method: "FIXED_PIPS",
            fixedPips: 30,
            atrMultiplier: 1.5,
            atrPeriod: 14,
          },
        },
        {
          id: "tp-buy",
          type: "take-profit",
          position: { x: 200, y: 540 },
          data: {
            label: "Buy Take Profit",
            category: "trading",
            tradingType: "take-profit",
            method: "FIXED_PIPS",
            fixedPips: 60,
            riskRewardRatio: 2,
            atrMultiplier: 3,
            atrPeriod: 14,
          },
        },
        {
          id: "sl-sell",
          type: "stop-loss",
          position: { x: 450, y: 540 },
          data: {
            label: "Sell Stoploss",
            category: "trading",
            tradingType: "stop-loss",
            method: "FIXED_PIPS",
            fixedPips: 30,
            atrMultiplier: 1.5,
            atrPeriod: 14,
          },
        },
        {
          id: "tp-sell",
          type: "take-profit",
          position: { x: 650, y: 540 },
          data: {
            label: "Sell Take Profit",
            category: "trading",
            tradingType: "take-profit",
            method: "FIXED_PIPS",
            fixedPips: 60,
            riskRewardRatio: 2,
            atrMultiplier: 3,
            atrPeriod: 14,
          },
        },
      ],
      edges: [
        { id: "e1", source: "timing1", target: "rsi1" },
        { id: "e2", source: "rsi1", target: "buy1" },
        { id: "e3", source: "rsi1", target: "sell1" },
        { id: "e4", source: "buy1", target: "sl-buy" },
        { id: "e5", source: "buy1", target: "tp-buy" },
        { id: "e6", source: "sell1", target: "sl-sell" },
        { id: "e7", source: "sell1", target: "tp-sell" },
      ],
      viewport: { x: 0, y: 0, zoom: 0.8 },
      metadata: meta,
      settings: {
        magicNumber: 100002,
        comment: "RSI Mean Reversion",
        maxOpenTrades: 1,
        allowHedging: false,
        maxTradesPerDay: 0,
      },
    } as BuildJsonSchema,
  },
  {
    id: "breakout-strategy",
    name: "Breakout Strategy",
    description:
      "Breakout strategy trading the Asian session range during custom weekday hours (8-17). Uses ATR-based stop loss and 1.5:1 risk-reward take profit.",
    tier: "FREE",
    buildJson: {
      version: "1.0",
      nodes: [
        {
          id: "timing1",
          type: "custom-times",
          position: { x: 300, y: 0 },
          data: {
            label: "Weekday Hours",
            category: "timing",
            timingType: "custom-times",
            days: {
              monday: true,
              tuesday: true,
              wednesday: true,
              thursday: true,
              friday: true,
              saturday: false,
              sunday: false,
            },
            timeSlots: [{ startHour: 8, startMinute: 0, endHour: 17, endMinute: 0 }],
          },
        },
        {
          id: "rb1",
          type: "range-breakout",
          position: { x: 300, y: 180 },
          data: {
            label: "Asian Range Breakout",
            category: "priceaction",
            priceActionType: "range-breakout",
            timeframe: "H1",
            rangeType: "SESSION",
            lookbackCandles: 20,
            rangeSession: "ASIAN",
            sessionStartHour: 0,
            sessionStartMinute: 0,
            sessionEndHour: 8,
            sessionEndMinute: 0,
            breakoutDirection: "BOTH",
            entryMode: "ON_CLOSE",
            bufferPips: 2,
            minRangePips: 10,
            maxRangePips: 0,
          },
        },
        {
          id: "buy1",
          type: "place-buy",
          position: { x: 100, y: 360 },
          data: {
            label: "Place Buy",
            category: "trading",
            tradingType: "place-buy",
            method: "FIXED_LOT",
            fixedLot: 0.1,
            riskPercent: 2,
            minLot: 0.01,
            maxLot: 10,
          },
        },
        {
          id: "sell1",
          type: "place-sell",
          position: { x: 550, y: 360 },
          data: {
            label: "Place Sell",
            category: "trading",
            tradingType: "place-sell",
            method: "FIXED_LOT",
            fixedLot: 0.1,
            riskPercent: 2,
            minLot: 0.01,
            maxLot: 10,
          },
        },
        {
          id: "sl-buy",
          type: "stop-loss",
          position: { x: 0, y: 540 },
          data: {
            label: "Buy ATR Stoploss",
            category: "trading",
            tradingType: "stop-loss",
            method: "ATR_BASED",
            fixedPips: 50,
            atrMultiplier: 1.5,
            atrPeriod: 14,
          },
        },
        {
          id: "tp-buy",
          type: "take-profit",
          position: { x: 200, y: 540 },
          data: {
            label: "Buy Take Profit",
            category: "trading",
            tradingType: "take-profit",
            method: "RISK_REWARD",
            fixedPips: 100,
            riskRewardRatio: 1.5,
            atrMultiplier: 3,
            atrPeriod: 14,
          },
        },
        {
          id: "sl-sell",
          type: "stop-loss",
          position: { x: 450, y: 540 },
          data: {
            label: "Sell ATR Stoploss",
            category: "trading",
            tradingType: "stop-loss",
            method: "ATR_BASED",
            fixedPips: 50,
            atrMultiplier: 1.5,
            atrPeriod: 14,
          },
        },
        {
          id: "tp-sell",
          type: "take-profit",
          position: { x: 650, y: 540 },
          data: {
            label: "Sell Take Profit",
            category: "trading",
            tradingType: "take-profit",
            method: "RISK_REWARD",
            fixedPips: 100,
            riskRewardRatio: 1.5,
            atrMultiplier: 3,
            atrPeriod: 14,
          },
        },
      ],
      edges: [
        { id: "e1", source: "timing1", target: "rb1" },
        { id: "e2", source: "rb1", target: "buy1" },
        { id: "e3", source: "rb1", target: "sell1" },
        { id: "e4", source: "buy1", target: "sl-buy" },
        { id: "e5", source: "buy1", target: "tp-buy" },
        { id: "e6", source: "sell1", target: "sl-sell" },
        { id: "e7", source: "sell1", target: "tp-sell" },
      ],
      viewport: { x: 0, y: 0, zoom: 0.8 },
      metadata: meta,
      settings: {
        magicNumber: 100003,
        comment: "Breakout Strategy",
        maxOpenTrades: 1,
        allowHedging: false,
        maxTradesPerDay: 0,
      },
    } as BuildJsonSchema,
  },
];
